<div class="dashboard-layout">
  <admin-sidebar></admin-sidebar>

  <div class="main-wrapper">
    <router-outlet></router-outlet>
    <div id="mainPage">
      <br />
      <div class="historyCard">
        <p-table
          #dt2
          [value]="tableRows"
          dataKey="id"
          [rows]="10"
          [rowsPerPageOptions]="[10,25,50]"
          [loading]="loading"
          [paginator]="true"
          [globalFilterFields]="['requestName','type','dateTime','userName','status','price']"
          [tableStyle]="{ 'min-width': '75rem' }"
        >
          <!-- Search -->
          <ng-template #caption>
            <div class="flex">
              <p-iconfield iconPosition="left" class="ml-auto">
                <p-inputicon><i class="pi pi-search"></i></p-inputicon>
                <input
                  #gfilter
                  pInputText
                  type="text"
                  (input)="dt2.filterGlobal(gfilter.value, 'contains')"
                  placeholder="Search requests/responses"
                />
              </p-iconfield>
            </div>
          </ng-template>

          <!-- Headers -->
          <ng-template #header>
            <tr>
              <th style="width:20%">Recipient Name</th>
              <th style="width:15%">Request Name</th>
              <th style="width:15%">Type</th>
              <th style="width:20%">Date/Time</th>
              <th style="width:20%">Helper Name</th>
              <th style="width:15%">Status</th>
              <th style="width:10%">Price</th>
            </tr>
            <tr>
              <th><p-columnFilter type="text" field="recipientUsernames" placeholder="Search" filterOn="input"></p-columnFilter></th>
              <th><p-columnFilter type="text" field="requestName" placeholder="Search" filterOn="input"></p-columnFilter></th>
              <th><p-columnFilter type="text" field="type" placeholder="Search" filterOn="input"></p-columnFilter></th>
              <th><p-columnFilter type="date" field="dateTime" filterMatchMode="equals"></p-columnFilter></th>
              <th><p-columnFilter type="text" field="userName" placeholder="Search" filterOn="input"></p-columnFilter></th>
              <th>
                <p-columnFilter field="status" matchMode="equals" [showMenu]="false">
                  <ng-template #filter let-value let-filter="filterCallback">
                    <p-select
                      [ngModel]="value"
                      (ngModelChange)="filter($event)"
                      [options]="statuses"
                      placeholder="Select"
                      [showClear]="true"
                      style="min-width:8rem"
                    >
                      <ng-template let-option #item>
                        <p-tag [value]="statusLabelMap[option.value]" [severity]="getSeverity(option.value)"></p-tag>
                      </ng-template>
                    </p-select>
                  </ng-template>
                </p-columnFilter>
              </th>
              <th><p-columnFilter type="numeric" field="price" filterMatchMode="gte" placeholder="Min price"></p-columnFilter></th>
            </tr>
          </ng-template>

          <!-- Table Body -->
          <ng-template #body let-row>
            <tr (click)="onRowClick(row, $event)" class="clickable-row">
              <td>{{ row.recipientUsernames }}</td>
              <td>{{ row.requestName }}</td>
              <td>{{ row.type }}</td>
              <td>{{ row.dateTime | date: 'short' }}</td>
              <td>{{ row.userName }}</td>
              <td>
                <p-tag
                  [value]="statusLabelMap[row.status] || row.status"
                  [severity]="getSeverity(row.status)"
                ></p-tag>
              </td>
              <td>{{ row.price }}</td>
            </tr>
          </ng-template>

          <!-- Empty Message -->
          <ng-template #emptymessage>
            <tr>
              <td colspan="7">No records found.</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>
