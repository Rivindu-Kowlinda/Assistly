<!-- employee-list.component.html -->
<div class="employee-table-container">
  <div class="table-header">
    <h2 class="table-title">Employee Management</h2>
    <p class="table-subtitle">Manage your team members and their information</p>
    
    <!-- Balance Points Display -->
    <div class="balance-info">
      <span class="balance-label">Available Points: </span>
      <span class="balance-amount">{{ userBalancePoints }}</span>
    </div>
    
    <!-- Insufficient Points Warning -->
    <div class="insufficient-points-warning" *ngIf="!hasAffordableEmployees && !loading">
      <i class="pi pi-exclamation-triangle warning-icon"></i>
      <span>{{ insufficientPointsMessage }}</span>
    </div>
    
    <!-- FIXED: Selected Cost Display - Shows potential costs since only accepting employee is charged -->
    <div class="selected-cost-info" 
         [class.cost-exceeded]="!canAffordSelection()"
         *ngIf="selectedCustomers.length > 0">
      
      <!-- Cost explanation -->
      <div class="cost-explanation-small">
        <i class="pi pi-info-circle"></i>
        <span class="cost-note-small">Only the employee who accepts your request will be charged.</span>
      </div>
      
      <!-- Potential Costs Header -->
      <div class="potential-costs-header">
        <strong>Potential Costs:</strong>
      </div>
      
      <!-- Best Case (Cheapest) -->
      <div class="cost-range cost-best-case">
        <span class="cost-label">Best Case (Cheapest):</span>
        <span class="cost-amount">{{ getMinSelectedCost() }} points</span>
      </div>
      
      <!-- Worst Case (Most Expensive) -->
      <div class="cost-range cost-worst-case">
        <span class="cost-label">Worst Case (Most Expensive):</span>
        <span class="cost-amount">{{ getMaxSelectedCost() }} points</span>
      </div>
      
      <!-- Warning if exceeds balance -->
      <span class="cost-warning" *ngIf="!canAffordSelection()">
        Exceeds available points ({{ userBalancePoints }} available)
      </span>
    </div>
  </div>

  <div class="table-card">
    <p-table
      #dt
      [value]="customers"
      [(selection)]="selectedCustomers"
      (selectionChange)="onSelectionChange($event)"
      dataKey="id"
      [rowHover]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      [rowsPerPageOptions]="[10,25,50]"
      [loading]="loading"
      [paginator]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      [filterDelay]="0"
      [globalFilterFields]="['name','role','price']"
      styleClass="custom-table"
    >
      <!-- Caption -->
      <ng-template #caption>
        <div class="table-controls">
          <div class="selected-info">
            <span class="selected-count" *ngIf="selectedCustomers.length > 0">
              {{ selectedCustomers.length }} selected
              <span *ngIf="selectedCustomers.length > 0" class="cost-preview">
                ({{ getMaxSelectedCost() }} pts to pay)
              </span>
            </span>
          </div>
          <div class="search-controls">
            <p-button
              outlined="true"
              icon="pi pi-filter-slash"
              label="Clear"
              (click)="clear(dt)"
              styleClass="clear-button"
            ></p-button>
            <p-iconField iconPosition="left" styleClass="search-field">
              <p-inputIcon><i class="pi pi-search"></i></p-inputIcon>
              <input
                pInputText
                type="text"
                [(ngModel)]="searchValue"
                (input)="dt.filterGlobal(searchValue, 'contains')"
                placeholder="Search employees..."
                class="search-input"
              />
            </p-iconField>
          </div>
        </div>
      </ng-template>

      <!-- Header -->
      <ng-template #header>
        <tr>
          <th style="width: 60px" class="checkbox-column">
            <p-tableHeaderCheckbox [disabled]="!hasAffordableEmployees"></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="name" class="name-column">
            <div class="column-header">
              <span>Name</span>
              <p-sortIcon field="name"></p-sortIcon>
            </div>
            <p-columnFilter
              type="text"
              field="name"
              display="menu"
              class="column-filter"
            ></p-columnFilter>
          </th>
          <th pSortableColumn="role" class="role-column">
            <div class="column-header">
              <span>Role</span>
              <p-sortIcon field="role"></p-sortIcon>
            </div>
            <p-columnFilter
              type="text"
              field="role"
              display="menu"
              class="column-filter"
            ></p-columnFilter>
          </th>
          <th pSortableColumn="price" class="price-column">
            <div class="column-header">
              <span>Cost</span>
              <p-sortIcon field="price"></p-sortIcon>
            </div>
            <p-columnFilter
              type="numeric"
              field="price"
              display="menu"
              class="column-filter"
            ></p-columnFilter>
          </th>
          <th class="affordability-column">
            <div class="column-header">
              <span>Affordability</span>
            </div>
          </th>
        </tr>
      </ng-template>

      <!-- Body -->
      <ng-template #body let-customer>
        <tr class="table-row" 
            [class.row-disabled]="!customer.canAfford"
            [class.row-affordable]="customer.canAfford"
            [class.row-selected]="isSelected(customer)">
          <td class="checkbox-cell">
            <p-tableCheckbox 
              [value]="customer" 
              [disabled]="!customer.canAfford">
            </p-tableCheckbox>
          </td>
          <td class="name-cell">
            <div class="employee-info" [class.employee-disabled]="!customer.canAfford">
              <div class="avatar" [class.avatar-disabled]="!customer.canAfford">
                {{ getInitials(customer.name) }}
              </div>
              <div class="employee-details">
                <span class="employee-name" [class.name-disabled]="!customer.canAfford">
                  {{ customer.name }}
                </span>
              </div>
            </div>
          </td>
          <td class="role-cell">
            <span class="role-badge" 
                  [class.badge-disabled]="!customer.canAfford"
                  [class.badge-selected]="isSelected(customer)">
              {{ customer.roleLabel }}
            </span>
          </td>
          <td class="price-cell">
            <span class="price-amount" 
                  [class.price-disabled]="!customer.canAfford"
                  [class.price-selected]="isSelected(customer)">
              {{ customer.price | number }} pts
            </span>
          </td>
          <td class="affordability-cell">
            <span class="affordability-status" 
                  [class.status-affordable]="customer.canAfford"
                  [class.status-unaffordable]="!customer.canAfford"
                  [class.status-selected]="isSelected(customer)">
              <i class="pi" 
                 [class.pi-check]="customer.canAfford"
                 [class.pi-times]="!customer.canAfford"></i>
              {{ customer.canAfford ? 'Affordable' : 'Too Expensive' }}
            </span>
          </td>
        </tr>
      </ng-template>

      <!-- Empty -->
      <ng-template #emptymessage>
        <tr>
          <td colspan="5" class="empty-message">
            <div class="empty-state">
              <i class="pi pi-users empty-icon"></i>
              <h3>No employees found</h3>
              <p>Try adjusting your search criteria</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>